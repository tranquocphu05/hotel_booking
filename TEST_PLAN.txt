# System Test Plan

## 1. Booking Flow Tests

### 1.1. Basic Booking
- [ ] **Test Case 1**: User books a single room type (1 room, 1 night).
    - **Input**: Valid dates, 1 room, valid user info.
    - **Expected**: Booking created, status `cho_xac_nhan`, Invoice created (`cho_thanh_toan`), Room assigned in `phong_ids`.
- [ ] **Test Case 2**: User books multiple rooms of the same type.
    - **Input**: 2 rooms of Type A.
    - **Expected**: Booking created, `so_luong_da_dat` = 2, `phong_ids` has 2 unique IDs.
- [ ] **Test Case 3**: User books multiple room types (Type A + Type B).
    - **Input**: 1 room Type A, 1 room Type B.
    - **Expected**: Booking created, `room_types` JSON contains both types, `phong_ids` contains IDs from both types.

### 1.2. Validation & Constraints
- [ ] **Test Case 4**: Attempt to book more rooms than available.
    - **Input**: Request 5 rooms when only 3 are available.
    - **Expected**: Error message "Chỉ có X phòng trống...".
- [ ] **Test Case 5**: Attempt to book with invalid dates (Checkout < Checkin).
    - **Input**: Checkin: Tomorrow, Checkout: Today.
    - **Expected**: Validation error.
- [ ] **Test Case 6**: Attempt to book with past dates.
    - **Input**: Checkin: Yesterday.
    - **Expected**: Validation error.

### 1.3. Concurrency & Availability
- [ ] **Test Case 7**: Simultaneous booking attempt (Race Condition Simulation).
    - **Input**: 2 users try to book the last available room at the exact same time.
    - **Expected**: One succeeds, one fails with "Sold out" message. (Requires tool/script to simulate).

## 2. Financial & Payment Tests

### 2.1. Invoice Logic
- [ ] **Test Case 8**: Verify Invoice creation.
    - **Check**: `hoa_don` table has record linked to `dat_phong_id`.
    - **Check**: `tong_tien` matches booking total.
- [ ] **Test Case 9**: Voucher Application.
    - **Input**: Valid voucher code.
    - **Expected**: `giam_gia` > 0, `tong_tien` reduced correctly.
- [ ] **Test Case 10**: Invalid Voucher.
    - **Input**: Expired or used-up voucher.
    - **Expected**: Error message, no discount applied.

## 3. Room Status Lifecycle Tests

### 3.1. Status Transitions
- [ ] **Test Case 11**: Confirm Booking.
    - **Action**: Admin/System changes booking to `da_xac_nhan`.
    - **Expected**: Assigned rooms in `phong` table update to `dang_thue` (if current date is within stay period).
- [ ] **Test Case 12**: Cancel Booking.
    - **Action**: Cancel a confirmed booking.
    - **Expected**: Assigned rooms update to `trong`.
- [ ] **Test Case 13**: Checkout.
    - **Action**: Change booking to `da_tra`.
    - **Expected**: Assigned rooms update to `dang_don`.

## 4. Admin & Management Tests

### 4.1. Admin Dashboard
- [ ] **Test Case 14**: Admin views booking list.
    - **Expected**: New bookings appear with correct status.
- [ ] **Test Case 15**: Admin details view.
    - **Expected**: Shows correct room types, assigned rooms, and financial breakdown.
