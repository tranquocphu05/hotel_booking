# HÆ°á»›ng Dáº«n Sá»­ Dá»¥ng Check-in/Check-out & Dá»‹ch Vá»¥

## ğŸ“‹ Tá»•ng Quan

Há»‡ thá»‘ng quáº£n lÃ½ check-in/check-out vÃ  dá»‹ch vá»¥ phÃ¡t sinh cho phÃ©p:
- Check-in khÃ¡ch khi Ä‘áº¿n khÃ¡ch sáº¡n
- ThÃªm dá»‹ch vá»¥ trong thá»i gian khÃ¡ch á»Ÿ
- Check-out vÃ  tÃ­nh toÃ¡n phá»¥ phÃ­ (náº¿u cÃ³)
- Tá»± Ä‘á»™ng cáº­p nháº­t hÃ³a Ä‘Æ¡n

## ğŸ”„ Luá»“ng Hoáº¡t Äá»™ng

```
1. BOOKING ONLINE
   â”œâ”€ KhÃ¡ch Ä‘áº·t phÃ²ng
   â”œâ”€ Thanh toÃ¡n tiá»n phÃ²ng (VNPay)
   â””â”€ Booking: da_xac_nhan

2. CHECK-IN
   â”œâ”€ KhÃ¡ch Ä‘áº¿n khÃ¡ch sáº¡n
   â”œâ”€ Staff verify thÃ´ng tin
   â”œâ”€ Click "Check-in Ngay"
   â”œâ”€ Ghi nháº­n: thoi_gian_checkin, nguoi_checkin
   â””â”€ Room status: dang_thue

3. TRONG THá»œI GIAN á»
   â”œâ”€ KhÃ¡ch dÃ¹ng dá»‹ch vá»¥ (gá»i Ä‘iá»‡n/nháº¯n tin)
   â”œâ”€ Staff thÃªm dá»‹ch vá»¥ vÃ o booking
   â”œâ”€ Tá»± Ä‘á»™ng cá»™ng vÃ o tá»•ng tiá»n
   â””â”€ KhÃ´ng cáº§n workflow phá»©c táº¡p

4. CHECK-OUT
   â”œâ”€ Staff kiá»ƒm tra phÃ²ng
   â”œâ”€ Nháº­p phá»¥ phÃ­ (náº¿u cÃ³)
   â”œâ”€ Click "Check-out Ngay"
   â”œâ”€ TÃ­nh tá»•ng: Tiá»n phÃ²ng + Dá»‹ch vá»¥ + Phá»¥ phÃ­
   â”œâ”€ Ghi nháº­n: thoi_gian_checkout, nguoi_checkout
   â””â”€ Room status: dang_don
```

## ğŸ¯ HÆ°á»›ng Dáº«n Chi Tiáº¿t

### 1. Check-in

**Äiá»u kiá»‡n:**
- Booking pháº£i á»Ÿ tráº¡ng thÃ¡i `da_xac_nhan` (Ä‘Ã£ thanh toÃ¡n)
- ChÆ°a check-in trÆ°á»›c Ä‘Ã³

**CÃ¡c bÆ°á»›c:**
1. VÃ o trang chi tiáº¿t booking
2. TÃ¬m section "Quáº£n LÃ½ Check-in / Check-out"
3. Nháº­p ghi chÃº (tÃ¹y chá»n): VÃ­ dá»¥ "KhÃ¡ch yÃªu cáº§u phÃ²ng táº§ng cao"
4. Click "Check-in Ngay"

**Káº¿t quáº£:**
- Ghi nháº­n thá»i gian check-in
- Ghi nháº­n nhÃ¢n viÃªn xá»­ lÃ½
- PhÃ²ng chuyá»ƒn sang tráº¡ng thÃ¡i "Äang thuÃª"
- CÃ³ thá»ƒ thÃªm dá»‹ch vá»¥

### 2. ThÃªm Dá»‹ch Vá»¥

**Äiá»u kiá»‡n:**
- Booking Ä‘Ã£ check-in
- ChÆ°a check-out

**CÃ¡c bÆ°á»›c:**
1. Trong trang chi tiáº¿t booking, tÃ¬m section "Dá»‹ch Vá»¥ PhÃ¡t Sinh"
2. Click "ThÃªm Dá»‹ch Vá»¥"
3. Chá»n dá»‹ch vá»¥ tá»« dropdown (giÃ¡ tá»± Ä‘á»™ng Ä‘iá»n)
4. Nháº­p sá»‘ lÆ°á»£ng
5. ThÃªm ghi chÃº (tÃ¹y chá»n): VÃ­ dá»¥ "PhÃ²ng 101, giao lÃºc 14:00"
6. Click "ThÃªm"

**Káº¿t quáº£:**
- Dá»‹ch vá»¥ Ä‘Æ°á»£c thÃªm vÃ o booking
- Tá»± Ä‘á»™ng cá»™ng vÃ o tá»•ng tiá»n
- Cáº­p nháº­t hÃ³a Ä‘Æ¡n

**XÃ³a dá»‹ch vá»¥:**
- Click icon thÃ¹ng rÃ¡c bÃªn cáº¡nh dá»‹ch vá»¥
- XÃ¡c nháº­n xÃ³a
- Tá»± Ä‘á»™ng trá»« khá»i tá»•ng tiá»n

### 3. Check-out

**Äiá»u kiá»‡n:**
- Booking Ä‘Ã£ check-in
- ChÆ°a check-out

**CÃ¡c bÆ°á»›c:**
1. Trong section "Quáº£n LÃ½ Check-in / Check-out"
2. Nháº­p phá»¥ phÃ­ phÃ¡t sinh (náº¿u cÃ³): VÃ­ dá»¥ hÆ° há»ng Ä‘á»“ Ä‘áº¡c
3. Nháº­p lÃ½ do phá»¥ phÃ­
4. Nháº­p ghi chÃº check-out: TÃ¬nh tráº¡ng phÃ²ng
5. Click "Check-out Ngay"

**Phá»¥ phÃ­ check-out muá»™n (Tá»± Ä‘á»™ng):**
- Sau 12:00 Ä‘áº¿n 18:00: 50% giÃ¡ phÃ²ng
- Sau 18:00: 100% giÃ¡ phÃ²ng

**Káº¿t quáº£:**
- Ghi nháº­n thá»i gian check-out
- Ghi nháº­n nhÃ¢n viÃªn xá»­ lÃ½
- TÃ­nh tá»•ng phá»¥ phÃ­ (manual + check-out muá»™n)
- Cáº­p nháº­t hÃ³a Ä‘Æ¡n
- PhÃ²ng chuyá»ƒn sang "Äang dá»n"
- Booking chuyá»ƒn sang "ÄÃ£ tráº£ phÃ²ng"

## ğŸ’° TÃ­nh ToÃ¡n HÃ³a ÄÆ¡n

### CÃ´ng Thá»©c

```
Tá»•ng tiá»n = (Tiá»n phÃ²ng - Giáº£m giÃ¡) + Tiá»n dá»‹ch vá»¥ + Phá»¥ phÃ­

Trong Ä‘Ã³:
- Tiá»n phÃ²ng: Sá»‘ Ä‘Ãªm Ã— GiÃ¡ phÃ²ng Ã— Sá»‘ lÆ°á»£ng
- Giáº£m giÃ¡: Voucher (chá»‰ Ã¡p dá»¥ng cho tiá»n phÃ²ng)
- Tiá»n dá»‹ch vá»¥: Tá»•ng cÃ¡c dá»‹ch vá»¥ Ä‘Ã£ dÃ¹ng
- Phá»¥ phÃ­: Phá»¥ phÃ­ manual + Phá»¥ phÃ­ check-out muá»™n
```

### VÃ­ Dá»¥

```
Booking: 2 Ä‘Ãªm, 1 phÃ²ng Deluxe (2,000,000Ä‘/Ä‘Ãªm)
Voucher: Giáº£m 10%

Tiá»n phÃ²ng: 2 Ã— 2,000,000 = 4,000,000Ä‘
Giáº£m giÃ¡: 4,000,000 Ã— 10% = 400,000Ä‘
Tiá»n phÃ²ng sau giáº£m: 3,600,000Ä‘

Dá»‹ch vá»¥:
- Bá»¯a sÃ¡ng: 2 ngÆ°á»i Ã— 150,000 = 300,000Ä‘
- Massage: 1 giá» Ã— 300,000 = 300,000Ä‘
Tá»•ng dá»‹ch vá»¥: 600,000Ä‘

Phá»¥ phÃ­:
- HÆ° há»ng minibar: 200,000Ä‘
- Check-out muá»™n 3 giá»: 2,000,000Ä‘ (50%)
Tá»•ng phá»¥ phÃ­: 2,200,000Ä‘

Tá»”NG Cá»˜NG: 3,600,000 + 600,000 + 2,200,000 = 6,400,000Ä‘
```

## ğŸ“Š Tráº¡ng ThÃ¡i PhÃ²ng

| Tráº¡ng thÃ¡i | MÃ´ táº£ | Khi nÃ o |
|------------|-------|---------|
| `trong` | PhÃ²ng trá»‘ng | ChÆ°a cÃ³ booking hoáº·c Ä‘Ã£ dá»n xong |
| `dang_thue` | Äang thuÃª | Sau khi check-in |
| `dang_don` | Äang dá»n | Sau khi check-out |
| `bao_tri` | Báº£o trÃ¬ | Admin set manual |

## ğŸ” Quyá»n Háº¡n

### Admin
- âœ… Check-in booking
- âœ… Check-out booking
- âœ… ThÃªm/xÃ³a dá»‹ch vá»¥
- âœ… Xem táº¥t cáº£ booking

### Client
- âŒ KhÃ´ng thá»ƒ check-in/check-out
- âŒ KhÃ´ng thá»ƒ thÃªm dá»‹ch vá»¥ trá»±c tiáº¿p
- âœ… Xem booking cá»§a mÃ¬nh
- âœ… Gá»i Ä‘iá»‡n yÃªu cáº§u dá»‹ch vá»¥

## ğŸ› ï¸ Quáº£n LÃ½ Dá»‹ch Vá»¥

### ThÃªm Dá»‹ch Vá»¥ Má»›i

1. VÃ o **Admin â†’ Services**
2. Click "ThÃªm dá»‹ch vá»¥"
3. Nháº­p thÃ´ng tin:
   - TÃªn dá»‹ch vá»¥
   - GiÃ¡
   - ÄÆ¡n vá»‹ (ngÆ°á»i, giá», láº§n, kg...)
   - Loáº¡i (Äƒn uá»‘ng, giáº·t á»§i, spa, váº­n chuyá»ƒn, khÃ¡c)
   - MÃ´ táº£
4. Upload áº£nh (tÃ¹y chá»n)
5. LÆ°u

### Sá»­a/XÃ³a Dá»‹ch Vá»¥

- Click "Sá»­a" Ä‘á»ƒ cáº­p nháº­t thÃ´ng tin
- Click "Ngá»«ng hoáº¡t Ä‘á»™ng" Ä‘á»ƒ táº¡m áº©n (khÃ´ng xÃ³a)
- Dá»‹ch vá»¥ Ä‘Ã£ dÃ¹ng trong booking khÃ´ng thá»ƒ xÃ³a

## ğŸ“± API Endpoints

### Check-in
```
POST /admin/dat_phong/{id}/checkin
Body: {
  "ghi_chu_checkin": "Optional note"
}
```

### Check-out
```
POST /admin/dat_phong/{id}/checkout
Body: {
  "phi_phat_sinh": 200000,
  "ly_do_phi": "HÆ° há»ng minibar",
  "ghi_chu_checkout": "PhÃ²ng sáº¡ch sáº½"
}
```

### ThÃªm Dá»‹ch Vá»¥
```
POST /admin/booking-services
Body: {
  "dat_phong_id": 123,
  "service_id": 5,
  "quantity": 2,
  "unit_price": 150000,
  "ghi_chu": "PhÃ²ng 101"
}
```

### XÃ³a Dá»‹ch Vá»¥
```
DELETE /admin/booking-services/{id}
```

## âš ï¸ LÆ°u Ã Quan Trá»ng

1. **Chá»‰ check-in khi khÃ¡ch Ä‘Ã£ thanh toÃ¡n**
   - Booking pháº£i á»Ÿ tráº¡ng thÃ¡i `da_xac_nhan`

2. **KhÃ´ng thá»ƒ sá»­a sau khi check-out**
   - Booking Ä‘Ã£ check-out khÃ´ng thá»ƒ thÃªm/xÃ³a dá»‹ch vá»¥

3. **Phá»¥ phÃ­ check-out muá»™n tá»± Ä‘á»™ng**
   - Há»‡ thá»‘ng tá»± tÃ­nh dá»±a trÃªn giá» check-out thá»±c táº¿

4. **Dá»‹ch vá»¥ tÃ­nh vÃ o hÃ³a Ä‘Æ¡n ngay**
   - KhÃ´ng cáº§n "xÃ¡c nháº­n" hay "hoÃ n thÃ nh"
   - Staff ghi nháº­n = Ä‘Ã£ dÃ¹ng

5. **PhÃ²ng tá»± Ä‘á»™ng chuyá»ƒn tráº¡ng thÃ¡i**
   - Check-in â†’ `dang_thue`
   - Check-out â†’ `dang_don`
   - Cáº§n set manual vá» `trong` sau khi dá»n xong

## ğŸ› Troubleshooting

### KhÃ´ng thá»ƒ check-in
- âœ… Kiá»ƒm tra booking Ä‘Ã£ thanh toÃ¡n chÆ°a
- âœ… Kiá»ƒm tra Ä‘Ã£ check-in trÆ°á»›c Ä‘Ã³ chÆ°a

### KhÃ´ng thá»ƒ thÃªm dá»‹ch vá»¥
- âœ… Kiá»ƒm tra Ä‘Ã£ check-in chÆ°a
- âœ… Kiá»ƒm tra Ä‘Ã£ check-out chÆ°a
- âœ… Kiá»ƒm tra dá»‹ch vá»¥ cÃ²n hoáº¡t Ä‘á»™ng khÃ´ng

### Tá»•ng tiá»n khÃ´ng Ä‘Ãºng
- âœ… Kiá»ƒm tra BookingPriceCalculator
- âœ… Kiá»ƒm tra invoice cÃ³ cáº­p nháº­t khÃ´ng
- âœ… Reload trang Ä‘á»ƒ xem sá»‘ má»›i nháº¥t

### PhÃ²ng khÃ´ng chuyá»ƒn tráº¡ng thÃ¡i
- âœ… Kiá»ƒm tra model events trong DatPhong
- âœ… Kiá»ƒm tra log Ä‘á»ƒ xem lá»—i

## ğŸ“ Support

Náº¿u gáº·p váº¥n Ä‘á», kiá»ƒm tra:
1. **Log files**: `storage/logs/laravel.log`
2. **Database**: Kiá»ƒm tra trá»±c tiáº¿p trong DB
3. **Browser Console**: Xem lá»—i JavaScript

---

**Version**: 1.0
**Last Updated**: 2024-11-19
**Laravel**: 12.x
